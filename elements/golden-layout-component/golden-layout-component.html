<!-- TODO I'll try to get rid of this... -->
<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.min.js"></script>

<!-- Golden-layout main script, minus some modificatin to make it work with Polymer -->
<script type="text/javascript" src="golden-layout-for-polymer.js"></script>

<!-- golden layout main style -->
<link rel="import" href="golden-layout-component-style.html">

<!-- Golden layout theme -->
<link rel="import" href="golden-layout-component-light-theme.html">

<!-- For resizing the layout -->
<link rel="import" href="../../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">

<dom-module id="golden-layout-component">
  <template>
    <style include="golden-layout-component-style"></style>
    <style include="golden-layout-component-light-theme"></style>
    <style>
      :host {
        display: block;
        overflow: hidden;
      }

      :host #metacontainer {
        overflow: hidden;
        width: 100%;
        height: 100%;
      }

      :host #container {
        width: 100%;
        height: 100%;
      }
    </style>
    <div id="metacontainer">
      <div id="container"></div>
    </div>
    <!-- <taaabs-base-overview id="tbo" ktbs-url="https://liris-ktbs01.insa-lyon.fr:8000/hubble/baseTestRemi/" language="fr"></taaabs-base-overview> -->
  </template>
  <script>
    Polymer({
      is: 'golden-layout-component',

      behaviors: [Polymer.IronResizableBehavior],

      properties: {
        layout: {
          type: Object,
          notify: true,
          value: null
        }
      },

      attached: function() {

        // Layout configuration
        var config = {
          settings: {
            hasHeaders: true,
            constrainDragToContainer: true,
            reorderEnabled: true,
            selectionEnabled: true,
            popoutWholeStack: false,
            blockedPopoutsThrowError: true,
            closePopoutsOnUnload: true,
            showPopoutIcon: false,
            showMaximiseIcon: true,
            showCloseIcon: true
          },
          content: []
        };

        // Create the layout
        this.layout = new GoldenLayout(config, this.$.container, this.$.metacontainer);

        // Initialize the layout
        this.layout.init();

        this.layout.on('itemDestroyed', function(evt) {

          if (evt.type === "component") {
            this.fire('itemDestroyed', {
              itemName: evt.componentName
            });
          }
        }.bind(this));

        // Listen to resize event on the golden-layout-component
        this.addEventListener('iron-resize', function() {
          this.layout.updateSize(this.$.container.offsetWidth, this.$.container.offsetHeight);
        }.bind(this));
      },

      /**
       * Add a new component to the layout.
       *
       * @param {!required} name {String} Name of the component. Should be UNIQUE.
       *
       * @param {!required} component {Object} The DOM object of the component to add.
       *
       * @method registerComponent
       */
      registerComponent: function(name, component) {

        // Create new golden-layout config.
        var newItemConfig = {
          type: 'component',
          componentName: name,
          componentState: {}
        };

        // Register the new component.
        try {
          this.layout.registerComponent(name, function(container, componentState) {
            container.getElement().html(component);
          });
        } catch (e) {}

        // Add the new component.
        try {
          this.layout.root.contentItems[0].addChild(newItemConfig);
        } catch (e) {
          this.layout.root.addChild(newItemConfig);
        }

      },

      registerComponents: function(list, config) {

        function _createfunc(domObj) {
          return function(container, componentState) {
            container.getElement().html(domObj);
          };
        }

        for (var _name in list) {
          this.layout.registerComponent(_name, _createfunc(list[_name]));
        }

        // Add the new component.
        try {
          this.layout.root.contentItems[0].addChild(config);
        } catch (e) {
          this.layout.root.addChild(config);
        }

      }
    });
  </script>
</dom-module>
